------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\will\school-age-children-and-covid\analysis\log\07b_an_multivariable_cox_models_FULL_Sense2_non_covid_death.log
  log type:  text
 opened on:  26 Aug 2020, 18:36:53

. 
. *set trace on
. 
. ******************************
. *  Multivariable Cox models  *
. ******************************
. 
. *************************************************************************************
. *PROG TO DEFINE THE BASIC COX MODEL WITH OPTIONS FOR HANDLING OF AGE, BMI, ETHNICITY:
. cap prog drop basecoxmodel

. prog define basecoxmodel
  1.         syntax , exposure(string) age(string) [ethnicity(real 0) if(string)] bmi(string) smoking(string)
  2.         if `ethnicity'==1 local ethnicity "i.ethnicity"
  3.         else local ethnicitytimer clear
  4. timer on 1
  5.         capture stcox   `exposure'                      ///
>                         $demogadjlist                           ///
>                         $comordidadjlist                        ///
>                         `if'                                            ///
>                         , strata(stp) vce(cluster household_id)
  6. timer off 1
  7. timer list
  8. end

. *************************************************************************************
. 
. 
. * Open dataset and fit specified model(s)
. forvalues x=0/1 {
  2. 
. use "$tempdir\cr_create_analysis_dataset_STSET_`outcome'_ageband_`x'.dta", clear
  3. 
. foreach exposure_type in        kids_cat3  {
  4.  
. *Complete case ethnicity model
. basecoxmodel, exposure("i.`exposure_type'") age("age1 age2 age3") ethnicity(1) bmi(i.bmicat) smoking(i.smoke)
  5. if _rc==0{
  6. estimates
  7. estimates save ./output/an_multivariate_cox_models_`outcome'_`exposure_type'_MAINFULLYADJMODEL_CCeth_bmi_smok_ageband_`x', replace
  8. *estat concordance /*c-statistic*/
.  }
  9.  else di "WARNING CC ETHN BMI SMOK MODEL WITH AGESPLINE DID NOT FIT (OUTCOME `outcome')" 
 10.  
.  }
 11.  
.  }
   1:  10015.00 /        1 =   10015.0050

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
active results
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =   11,870,825             Number of obs    =  11,870,825
No. of failures      =       10,012
Time at risk         =   2183091954
                                                Wald chi2(37)    =    54804.48
Log pseudolikelihood =   -113813.67             Prob > chi2      =      0.0000

                                    (Std. Err. adjusted for 6,752,811 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .6683028   .0274415    -9.81   0.000     .6166257    .7243106
               Kids under 18  |   .7207151   .0328223    -7.19   0.000      .659172    .7880042
                              |
                         age1 |   1.095989   .0133709     7.51   0.000     1.070093    1.122511
                         age2 |   1.014743   .0286633     0.52   0.604     .9600907    1.072506
                         age3 |   .8658255   .0592638    -2.10   0.035     .7571249    .9901323
                       1.male |   1.369091   .0288983    14.88   0.000     1.313607    1.426919
                              |
                          imd |
                           2  |   1.130491   .0415234     3.34   0.001     1.051967    1.214876
                           3  |   1.291175   .0466827     7.07   0.000     1.202846    1.385991
                           4  |   1.474522   .0524503    10.92   0.000     1.375224    1.580991
             5 most deprived  |    1.86556   .0661837    17.58   0.000     1.740249    1.999894
                              |
                tot_adults_hh |
                           2  |   .7305248   .0182402   -12.58   0.000     .6956354    .7671641
                           3  |   .7050427   .0188434   -13.08   0.000     .6690608    .7429596
                              |
           1.htdiag_or_highbp |   1.144618   .0260559     5.93   0.000     1.094672    1.196843
1.chronic_respiratory_disease |   2.755246   .0878024    31.80   0.000      2.58842    2.932823
                     1.asthma |   .9889844   .0274314    -0.40   0.690     .9366552    1.044237
    1.chronic_cardiac_disease |   1.874187   .0586695    20.07   0.000     1.762653    1.992778
                              |
                      diabcat |
            T1DM, controlled  |   2.305258   .3227584     5.97   0.000     1.752036    3.033164
          T1DM, uncontrolled  |    2.52325   .2371818     9.85   0.000     2.098692    3.033696
            T2DM, controlled  |   1.325964   .0509168     7.35   0.000     1.229831     1.42961
          T2DM, uncontrolled  |   1.661058   .0648635    13.00   0.000     1.538671     1.79318
          Diabetes, no HbA1c  |   3.123075   .6274408     5.67   0.000     2.106551    4.630127
                              |
            cancer_exhaem_cat |
                   Last year  |   37.03696    1.30052   102.86   0.000     34.57373     39.6757
               2-5 years ago  |   14.35028   .4784864    79.89   0.000     13.44245    15.31942
                    5+ years  |   4.820822    .191303    39.64   0.000     4.460085    5.210735
                              |
              cancer_haem_cat |
                   Last year  |   7.133778   1.018849    13.76   0.000     5.392009    9.438186
               2-5 years ago  |   4.125363   .4411872    13.25   0.000     3.345264    5.087378
                    5+ years  |   1.904721   .1965649     6.24   0.000     1.555924    2.331709
                              |
      1.chronic_liver_disease |   5.867553   .2504088    41.46   0.000     5.396726    6.379456
            1.stroke_dementia |   1.935302   .0931561    13.72   0.000     1.761067    2.126774
                1.other_neuro |   3.077468   .1806354    19.15   0.000     2.743035    3.452676
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.728612    .076012    12.45   0.000     1.585871    1.884201
           Stage 4/5 egfr<30  |   5.092352   .4515354    18.36   0.000     4.279992    6.058901
                              |
                       1.esrd |   1.600005    .171973     4.37   0.000      1.29608    1.975199
           1.other_transplant |   .7625535   .1467689    -1.41   0.159     .5229249    1.111991
                   1.asplenia |   2.048991   .2333922     6.30   0.000     1.639016    2.561515
           1.ra_sle_psoriasis |   1.102937   .0436506     2.48   0.013     1.020617    1.191896
               1.other_immuno |   1.820199   .1780753     6.12   0.000       1.5026    2.204928
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_non_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth_bmi_smok_ageband_0.ster not found)
file ./output/an_multivariate_cox_models_non_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth_bmi_smok_ageband_0.ster saved
   1:  12695.50 /        2 =    6347.7490

------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
active results
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Stratified Cox regr. -- Breslow method for ties

No. of subjects      =    3,329,528             Number of obs    =   3,329,528
No. of failures      =       50,756
Time at risk         =    606823725
                                                Wald chi2(37)    =   106863.33
Log pseudolikelihood =   -562196.04             Prob > chi2      =      0.0000

                                    (Std. Err. adjusted for 2,523,113 clusters in household_id)
-----------------------------------------------------------------------------------------------
                              |               Robust
                           _t | Haz. Ratio   Std. Err.      z    P>|z|     [95% Conf. Interval]
------------------------------+----------------------------------------------------------------
                    kids_cat3 |
               Kids under 12  |   .8864925   .0350879    -3.04   0.002     .8203214    .9580014
               Kids under 18  |    .950511   .0483734    -1.00   0.319      .860276    1.050211
                              |
                         age1 |   1.081002   .0064103    13.13   0.000     1.068511    1.093639
                         age2 |   .9725044   .0221277    -1.23   0.220     .9300877    1.016855
                         age3 |   1.169221    .066963     2.73   0.006     1.045074    1.308115
                       1.male |   1.163857   .0110326    16.01   0.000     1.142433    1.185683
                              |
                          imd |
                           2  |   1.092294   .0150784     6.40   0.000     1.063138    1.122251
                           3  |   1.166954   .0162974    11.06   0.000     1.135445    1.199338
                           4  |   1.257632   .0182903    15.76   0.000      1.22229    1.293996
             5 most deprived  |   1.422937   .0223225    22.48   0.000     1.379852    1.467368
                              |
                tot_adults_hh |
                           2  |    .885457   .0092395   -11.66   0.000     .8675319    .9037526
                           3  |   1.036098   .0164367     2.24   0.025     1.004378    1.068819
                              |
           1.htdiag_or_highbp |   .9286737   .0101137    -6.79   0.000     .9090613    .9487092
1.chronic_respiratory_disease |   2.013248   .0220621    63.85   0.000     1.970468    2.056956
                     1.asthma |   .8902781   .0122665    -8.44   0.000     .8665579    .9146477
    1.chronic_cardiac_disease |   1.522221   .0149809    42.69   0.000      1.49314    1.551868
                              |
                      diabcat |
            T1DM, controlled  |   1.844341   .1746701     6.46   0.000     1.531889    2.220522
          T1DM, uncontrolled  |   2.055819   .1252827    11.83   0.000     1.824367    2.316635
            T2DM, controlled  |   1.242418   .0149551    18.03   0.000      1.21345    1.272078
          T2DM, uncontrolled  |   1.378268   .0229149    19.30   0.000      1.33408    1.423921
          Diabetes, no HbA1c  |   1.810166   .2109331     5.09   0.000     1.440557    2.274607
                              |
            cancer_exhaem_cat |
                   Last year  |    7.86902    .141886   114.41   0.000     7.595785    8.152083
               2-5 years ago  |   2.980955   .0481573    67.61   0.000     2.888047    3.076852
                    5+ years  |   1.565963   .0202713    34.65   0.000     1.526732    1.606203
                              |
              cancer_haem_cat |
                   Last year  |   4.217752   .2454009    24.74   0.000     3.763186    4.727226
               2-5 years ago  |   2.480209   .1006776    22.38   0.000     2.290529    2.685595
                    5+ years  |   1.731207    .057697    16.47   0.000     1.621737    1.848066
                              |
      1.chronic_liver_disease |    2.57387   .0786922    30.92   0.000     2.424166    2.732818
            1.stroke_dementia |   1.700215   .0206021    43.80   0.000     1.660312    1.741078
                1.other_neuro |   2.114897   .0465315    34.04   0.000     2.025636    2.208092
                              |
  reduced_kidney_function_cat |
Stage 3a/3b egfr 30-60        |   1.136212    .012018    12.07   0.000     1.112899    1.160012
           Stage 4/5 egfr<30  |   2.294315   .0437517    43.55   0.000     2.210146    2.381689
                              |
                       1.esrd |   2.267155   .1061921    17.48   0.000     2.068291    2.485141
           1.other_transplant |   1.020075   .1806114     0.11   0.911     .7209763    1.443256
                   1.asplenia |   1.404488   .0959386     4.97   0.000     1.228496    1.605693
           1.ra_sle_psoriasis |   1.141213   .0180761     8.34   0.000     1.106329    1.177197
               1.other_immuno |   2.067388   .1405405    10.68   0.000     1.809496    2.362036
-----------------------------------------------------------------------------------------------
                                                             Stratified by stp
(note: file ./output/an_multivariate_cox_models_non_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth_bmi_smok_ageband_1.ster not found)
file ./output/an_multivariate_cox_models_non_covid_death_kids_cat3_MAINFULLYADJMODEL_CCeth_bmi_smok_ageband_1.ster saved

. 
. 
. log close
      name:  <unnamed>
       log:  E:\will\school-age-children-and-covid\analysis\log\07b_an_multivariable_cox_models_FULL_Sense2_non_covid_death.log
  log type:  text
 closed on:  26 Aug 2020, 22:09:54
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
